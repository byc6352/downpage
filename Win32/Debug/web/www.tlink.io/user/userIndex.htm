






<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<link rel="icon" href="/images/favicon.ico">
<script src="/js/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/css/jquery.datetimepicker.css">
<link rel="stylesheet" type="text/css" href="/css/myIndex.css">
<link rel="stylesheet" type="text/css" href="/css/style.min.css">
<script type="text/javascript" src="/js/jquery-form.js"></script>
<script type="text/javascript" src="/js/navbar.js"></script>
<script type="text/javascript" src="/js/jquery.datetimepicker.js"></script>
<script type="text/javascript" src="/js/address.js"></script>

<link rel="stylesheet" href="/css/new/jquery.bxslider.css">
<link rel="stylesheet" href="/css/new/index.css">
<script src="/js/new/index.js"></script>
<!-- 国内使用 -->
<script charset="utf-8" src="https://g.alicdn.com/sd/ncpc/nc.js?t=0.740922372476411"></script>
<!-- 若您的主要用户来源于海外，请替换使用下面的js资源 -->
<!-- <script type="text/javascript" charset="utf-8" src="http://aeis.alicdn.com/sd/ncpc/nc.js?t=2015052012"></script> -->

<input type="hidden" id="basePath" name="basePath" value="">

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cab9d2db73648c24a142c1d8df07c285";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();

//邮箱正则
function regEmail(email){
	var regEmail=/^([a-zA-Z0-9.]*[-_]?[a-zA-Z0-9]+)*@([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)+[\\.][A-Za-z]{2,3}([\\.][A-Za-z]{2})?$/;
	return regEmail.test(email)?true:false;
}
//手机号正则
function regMobile(mobile){
	var regMobile = /^1(3|4|5|7|8|9)\d{9}$/;	//手机号码格式：1开头接着3或4或5或7或8接着9位
	return regMobile.test(mobile)?true:false;
}
//电话正则
function regPhone(phone){
	 var regPhone = /^0(([1,2]\d)|([3-9]\d{2}))\d{7,8}$/;	//匹配固定电话 0开头接着非1或2接着数字两位接着7位或8位数字
	 return regPhone.test(phone)?true:false;
}
//中文姓名正则
function regChineseName(name){
	var regName = /^[\u4E00-\u9FA5]{2,4}$/;
	return regName.test(name)?true:false;
}
//中英文姓名正则
function regCnEnName(name){
	var regName = /^[\u4E00-\u9FA5a-zA-Z.●]+$/;	//匹配中文，英文字母及.●
	return regName.test(name)?true:false;
}
//纯数字正则
function regNumber(name){
	var regName = /^[0-9]+$/;
	return regName.test(name)?true:false;
}
//字母正则
function regLetter(name){
	var regName = /^[A-Za-z]+$/;
	return regName.test(name)?true:false;
}
//是否为纯数字加字母
function isNumberAndLetter(str){
	var numberCount=0,letterCount=0,otherCount=0;
	for(var i=0;i<str.length;i++){
		if(regNumber(str[i])){
			numberCount++;
		}else if(regLetter(str[i])){
			letterCount++;
		}else{
			otherCount++;
		}
	}
	if(numberCount>0&&letterCount>0&&otherCount>=0){
		return true;
	}else{
		return false;
	}
}

/*jquery 限制文本框不能输入反斜杠*/  
function fanXieGangLimit(obj){
   	$(obj).keyup(function(){    
         $(this).val($(this).val().replace(/[/]/g,''));  
     }).bind("paste",function(){  //CTR+V事件处理    
         $(this).val($(this).val().replace(/[/]/g,''));     
     }).css("ime-mode", "disabled"); //CSS设置输入法不可用
}

/*jquery 限制文本框不能输入汉字*/  
function chineseLimit(obj){
   	$(obj).keyup(function(){    
         $(this).val($(this).val().replace(/[\u4E00-\u9FA5]/g,''));  
     }).bind("paste",function(){  //CTR+V事件处理    
         $(this).val($(this).val().replace(/[\u4E00-\u9FA5]/g,''));     
     }).css("ime-mode", "disabled"); //CSS设置输入法不可用
}

/************图片裁剪********************/
var initCropperInModal = function(img, input,width,height){
    // 初始化
    var $image = $(img);
    // 上传图片
   	var $inputImage = $(input);
   	var options = {
        aspectRatio: width/height,	//纵横比
        autoCropArea:1,
        background:true,	//是否显示背景的黑白方格（类似PS里透明图层的显示方式）
        modal:true,	//非裁剪区域是否用黑罩遮盖。
        preview: '.up-pre-after',	// 预览图的class名
    }
    $image.cropper(options);
    var URL = window.URL || window.webkitURL;
    var blobURL;
    if (URL) {
        $inputImage.change(function () {
            var files = this.files;
            var file;
			if (!$image.data('cropper')) {
                return;
            }
            if (files && files.length) {
               file = files[0];
               // 判断是否是图像文件
               if (/^image\/\w+$/.test(file.type)) {
               		//如果URL已存在就先释放
               		if(blobURL) {
                        URL.revokeObjectURL(blobURL);
                    }
                    blobURL = URL.createObjectURL(file);
                    // 重置cropper
                    $image.cropper('reset').cropper('replace', blobURL);
                    $inputImage.val('');
                } else {
                    window.alert('请选择一张图片');
                }
            }
        });
    } else {
        $inputImage.prop('disabled', true);
    }
 
 }

//向右旋转
function rotateimgright(obj) {
	if($(obj).attr("src")!=null&&$.trim($(obj).attr("src"))!=""){
		$(obj).cropper('rotate', 90);
	}
}

//向左旋转
function rotateimgleft(obj) {
	if($(obj).attr("src")!=null&&$.trim($(obj).attr("src"))!=""){
		$(obj).cropper('rotate', -90);
	}
}
</script>
<!DOCTYPE html>
<html>
  <head>
    <base />
    <title>TLINK物联网-监控中心</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="Keywords" content=""/>
	<meta name="Description" content="" />
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0"> 
    <script src="/js/ezuikit.js"></script>
  </head>
<body>
<a id="llq" href="https://w.x.baidu.com/alading/anquan_soft_down_ub/14744"></a>
<div style="padding-left:0px;" class="container-fluid index_header"  >
     <!--头部-->
     



<input type="hidden" id="userId" value="200024636">
<a href="" id="queryEmail" target="_blank"></a>
<div class="pc-nav pc-nav-fixed">
	<a href="/index.htm" class="pc-new-logo">
		<img src="/images/new/logo.svg" alt="Tlink工业物联网平台，提供端管云一体化的物联网产品和解决方案。" title="Tlink工业物联网平台，提供端管云一体化的物联网产品和解决方案。" />
	</a>
	<ul class="pc-ul L ul-l">
		<a href="/index.htm" class="pc-a">
			首页
		</a>
		<a href="/yunApp.htm" class="pc-a">
			云组态
		</a>

<!-- 			设备探索 -->
<!-- 		</a> -->
		<a href="/help.htm" class="pc-a">
			帮助中心
		</a>

<!-- 			信息反馈 -->
<!-- 		</a> -->
		<a href="http://qy.tlink.io" target="_blank" class="pc-a">
			企业版
		</a>
	</ul>
	<ul class="pc-ul R">
	  	
			<a href="/user/userIndex.htm" class="pc-Console">
				控制台<!--登录后显示-->
			</a>
		
		<div class="ul-line">
		&nbsp;
		</div>
		<!-- 登录前-->
		
		<!-- 登录后-->
		
			<div class="pc-logging down">
				18121519253
				<div class="pc-logging-none down-none">
					<a href="/user/userIndex.htm" class="pc-logging-a">
						监控中心
					</a>
					<a href="/user/loginout.htm" class="pc-logging-a">
						退出
					</a>
				</div>
			</div> 
		
		<div class="ul-line">
		&nbsp;
		</div>
		<div href="#" class="pc-language down">
			中文/EN
			<div class="pc-language-none down-none">
				<a href="/changeLanguage.htm?language=cn" class="pc-language-a pc-language-b"class="pc-language-a">
					<div class="pc-language-img">
						<img src="/images/new/chaina_img.png" />
					</div>
					<div class="pc-language-txt">
						简体中文
					</div>
				</a>
				<a href="/changeLanguage.htm?language=en" class="pc-language-a">
					<div class="pc-language-img">
						<img src="/images/new/America_img.png" />
					</div>
					<div class="pc-language-txt">
						English
					</div>
				</a>
			</div>
		</div>
	</ul>
</div>
<!-- 登录 -->
<div class="modal fade" id="user" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog pc-dialog" role="document">
		<div class="modal-content pc-content">
			<div class="user-header">
				<a href="javascript:;" class="user-header-a user-header-b">
					账号登录
				</a>
			</div>
			<div class="pc-modal-body">
				<div class="pc-modal-list">
					<i class="login-user">
						<img src="/images/new/login-user.png" />
					</i>
					<input type="text" class="login_input" placeholder="请输入用户名/邮箱" id="loginName"/>
				</div>
				<div class="pc-modal-list">
					<i class="login-user">
						<img src="/images/new/password.png" />
					</i>
					<input type="password" class="login_input" placeholder="请输入密码" id="pass"/>
				</div>
				<div class="pc-modal-itme">
					<div class="pc-modal-left">
						<input type="checkbox" value="" class="pc-modal-check" id="demoDengLu"/>
						演示账号登录
					</div>
					<a href="/find_pwd_1.htm" class="pc-modal-right">
						忘记密码？
					</a>
				</div>
				<div class="pc-modal-itme">
					<a href="javascript:;" class="pc-modal-denglu" id="denglu">
						登录
					</a>
				</div>
				<div class="pc-modal-list">
					合作账号登录：
					<a href="/union/qqLogin.htm" class="pc-modal-ico">
						<img src="/images/new/qq.png" />
					</a>
					<a href="http://open.weixin.qq.com/connect/qrconnect?appid=wxc855f4c4e69f7ae5&redirect_uri=https://www.tlink.io/union/wxLogin.htm&response_type=code&scope=snsapi_login&state=t#wechat_redirect" class="pc-modal-ico">
						<img src="/images/new/weixin.png" />
					</a>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- 注册 -->
<div class="modal fade" id="register" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog pc-dialog" role="document">
		<div class="modal-content pc-content">
			<div class="user-header">
				<a href="#tab5" id="mobileFlag" class="user-header-a tab-a tab-b user-header-c reg-switch">
					手机注册
				</a>
				<a href="#tab6" id="emailFlag" class="user-header-a tab-a user-header-c reg-switch">
					邮箱注册
				</a>
			</div>
			<div class="pc-modal-body">
				<input type="hidden" id="regFlag" value="mobileFlag">
				<div class="tab-list tab-itme" id="tab5">
					<div class="pc-modal-list">
						<input type="text" class="register_input" placeholder="请输入手机号" id="mobile"/>
					</div>
					<div class="pc-modal-list nc-container" id="sliderNav">
						
					</div>
					<div class="pc-modal-list">
						<input type="text" class="register_yz" placeholder="请输入验证码" id="mobileCode" name="mobileCode"/>
						<a href="javascript:;" class="register_hq" id="mbtn">
							获取手机验证码
						</a>
					</div>
					<div class="pc-modal-list">
						<input type="password" class="register_input" placeholder="请输入密码" id="mobilePwd" name="mobilePwd"/>
					</div>
					<div class="pc-modal-list">
						<input type="password" class="register_input" placeholder="请再次输入密码" id="mobileAgainPwd" name="mobileAgainPwd"/>
					</div>
					<div class="pc-modal-list">
						<a href="javascript:;" class="pc-modal-denglu pc-user-reg">
							注册
						</a>
					</div>
				</div>
				<div class="tab-list" id="tab6">
					<div class="pc-modal-list">
						<input type="text" class="register_input" placeholder="请输入邮箱" id="email"/>
					</div>
					<div class="pc-modal-list">
						<input type="text" class="register_yz" placeholder="请输入验证码" id="emailCode" name="emailCode"/>
						<a href="javascript:;" class="register_hq" id="ebtn">
							获取邮箱验证码
						</a>
					</div>
					<div class="pc-modal-list">
						<input type="password" class="register_input" placeholder="请输入密码" id="emailPwd" name="emailPwd"/>
					</div>
					<div class="pc-modal-list">
						<input type="password" class="register_input" placeholder="请再次输入密码" id="emailAgainPwd" name="emailAgainPwd"/>
					</div>
					<div class="pc-modal-list">
						<a href="javascript:;" class="pc-modal-denglu pc-user-reg">
							注册
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- 客服 -->
		<div class="z-kefu">
			<a href="javascript:;" class="z-kefu-popu">
				联<br />
				系<br />
				我<br />
				们<br />
				<<br />
			</a>
			<div class="z-kefu-qq">
				<div class="z-kefu-qq-title">
					硬件咨询
				</div>
				<div class="z-kefu-con">
					<a target="_blank" href="http://wpa.qq.com/msgrd?v=3&amp;uin=476252756&amp;site=qq&amp;menu=yes" alt="点击这里给我发消息" title="点击这里给我发消息" class="z-qq-a">
						<div class="z-qq-img">
							<img src="/images/new/qq.png">
						</div>
						技术支持
					</a>
				</div>
				<div class="z-kefu-qq-title">
					平台咨询
				</div>
				<div class="z-kefu-con">
					<a target="_blank" href="http://wpa.qq.com/msgrd?v=3&amp;uin=476252756&amp;site=qq&amp;menu=yes" alt="点击这里给我发消息" title="点击这里给我发消息" class="z-qq-a">
						<div class="z-qq-img">
							<img src="/images/new/qq.png">
						</div>
						技术支持
					</a>
				</div>
				<div class="z-kefu-qq-title">
					关注微信
				</div>
				<div class="z-kefu-con">
					<div class="z-kefu-erweima" style="cursor:pointer;" onclick="javascript:window.location.href='/wechat_alarm.htm?menu=触发器'">
						<img src="/images/new/weixin.jpg">
					</div>
				</div>
				<div class="z-kefu-qq-title">
					联系电话
				</div>
				<div class="z-kefu-con">
					<a target="_blank" href="javascript:;" class="z-qq-a">
						<div class="z-qq-img">
							<img src="/images/new/phone.png">
						</div>
						0755-23329978
					</a>
				</div>
			</div>
		</div>
<script type="text/javascript">
       
       function checkForm(){
       		var reg = $("#reg").val();
       		if(reg == '1'){
       			var Password_2 = $("#Password1").val();
       			var ConfirmPassword_2 = $("#ConfirmPassword1").val();
       			var mobile = $("#mobile").val();
       			var mobilecode = $("#mobilecode").val();
       			if("" == mobile){
       			   alert("请输入手机号码！");
       			   return false;
       			}
       			if("" == mobilecode){
       			   alert("请输入手机验证码！");
       			   return false;
       			}
       			if("" == Password_2){
       			  alert("请输入密码！");
       			  return false;
       			}
       			if("" == ConfirmPassword_2){
       			  alert("请再次输入密码！");
       			  return false;
       			}
       			if(Password_2!=ConfirmPassword_2){
       				alert("两次密码输入不一致");
       				return false
       			}
       		}else{
       			var Password_1 = $("#Password_2").val();
       			var ConfirmPassword_1 = $("#ConfirmPassword_2").val();
       			var email = $("#email").val();
       			var emailcode = $("#emailcode").val();
       			if("" == email){
       			   alert("请输入邮箱！");
       			   return false;
       			}
       			if("" == emailcode){
       			   alert("请输入邮箱验证码！");
       			   return false;
       			}
       			if("" == Password_1){
       			  alert("请输入密码！");
       			  return false;
       			}
       			if("" == ConfirmPassword_1){
       			  alert("请再次输入密码！");
       			  return false;
       			}
       			if(Password_1!=ConfirmPassword_1){
       				alert("两次密码输入不一致");
       				return false
       			}
       		}
       	    $.ajax({
	           type: "POST",
	           dataType: "html",
	           url: "/user/registe.htm",
	           data: $('#regForm').serialize(),
	           success: function (data) {
	               var jsonObj = $.parseJSON(data);
				   if ('00' == jsonObj.flag) {
				      window.location.href = jsonObj.url;
				   }else{
				      alert(jsonObj.msg);
				   }
	            }, error: function(data) {
	               alert("error:" + data.responseText);
	            }
           });
       	   //$("#regForm").submit();
       }

</script>

<script type="text/javascript" src="//s.union.360.cn/203543.js" async defer></script>
     <!--主题-->
     <div class="index_c">
     <!--左侧栏-->
     




<!DOCTYPE html>
<html>
  <head>
   <title>TLINK-物联网,工业、农业、智能家居等相关物联网云服务运营专家</title>
   <meta name="Keywords" content=""/>
	<meta name="Description" content="" />
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">
	<link rel="stylesheet" href="/css/zutai/jquery.mCustomScrollbar.css">
	<script src="/js/zutai/jquery.mCustomScrollbar.concat.min.js"></script> 
	<script>
	//模拟滚动条
	(function($)
	{
		$(window).on("load",function(){
			$(".index_theLeft").mCustomScrollbar(
			{
				theme:"light-2",
			});
		});
		
		//查用户应用数
		$.ajax({
           type: "POST",
           url: "/user/queryCustomCount.htm",
           success: function (data) {
               var jsonObj = $.parseJSON(data);
			   if ('00' == jsonObj.flag) {
			   		var count=jsonObj.count;	//简易应用数
			   		if(count<1){
			   			$("#customLi").hide();
			   		}
			   		var zutaiCount=jsonObj.zutaiCount;	//组态应用数
			   		if(zutaiCount<1){
			   			$("#zutaiLi").hide();
			   		}
			   }
           }
       });
	})(jQuery);
	</script>
  </head>
  <body>
    <div class="index_theLeft">
    <br/>
                <ul class="dashboard-menu">
	                    <li>
	                        <a href="https://www.tlink.io/user/userIndex.htm">
	                            <i class="glyphicon glyphicon-record"></i>
	                            <h5>监控中心</h5>
	                        </a>
	                    </li>
                  
	                    <li>
	                        <a href="https://www.tlink.io/device/devices.htm">
	                            <i class="glyphicon glyphicon-blackboard"></i>
	                            <h5>设备</h5>
	                        </a>
	                    </li>
	                    <li>
	                        <a href="https://www.tlink.io/device/map.htm">
	                            <i class="glyphicon glyphicon-map-marker"></i>
	                            <h5>设备地图</h5>
	                        </a>
	                    </li>
	                    <li>
	                        <a href="https://www.tlink.io/alarms/all/queryAlarms.htm">
	                            <i class="glyphicon glyphicon-bell"></i>
	                            <h5>触发器</h5>
	                        </a>
	                    </li>
	                     <li id="customLi">
	                        <a href="https://www.tlink.io/user/queryUserCustomList.htm">
	                            <i class="glyphicon glyphicon-send"></i>
	                            <h5>简易应用</h5>
	                        </a>
	                    </li>

	                     <li id="zutaiLi">
	                        <a href="http://diy.tlink.io/configurationList.htm">
	                            <i class="glyphicon myIndex_fabuzutai"></i>
	                            <h5>组态应用</h5>
	                        </a>
	                      </li>
	                      <li>
	                        <a href="http://diy.tlink.io/goYunZutaiPage.htm">
	                            <i class="glyphicon glyphicon-cloud"></i>
	                            <h5>云组态</h5>
	                        </a>
	                     </li>
	                     <li>
	                        <a href="https://www.tlink.io/flowCard/queryFlow.htm">
	                            <i class="glyphicon glyphicon-credit-card"></i>
	                            <h5>流量卡</h5>
	                        </a>
	                    </li>
	                    <li>
	                        <a href="https://www.tlink.io/scheduler/queryUserScheduler.htm">
	                            <i class="glyphicon glyphicon-time"></i>
	                            <h5>定时任务</h5>
	                        </a>
	                    </li>

	                    <li>
	                        <a href="https://www.tlink.io/device/myDownload.htm">
	                            <i class="glyphicon glyphicon-arrow-down"></i>
	                            <h5>数据下载</h5>
	                        </a>
	                    </li>
	                    <li>
	                        <a href="https://www.tlink.io/contact/queryUserInfoByUserId.htm">
	                            <i class="glyphicon glyphicon-user"></i>
	                            <h5>用户中心</h5>
	                        </a>
	                    </li>
						                  
                </ul>
            </div>
  </body>
  
  <script type="text/javascript">
  	$(function(){
  		$.ajax({url: "/feedback/queryFbkIsReplay.htm", async:true,type:"POST", success:function (data) {
			var jsonObj = $.parseJSON(data);
			if ("00" == jsonObj.flag) {
				if(jsonObj.status=="1"){
					var img='<img src="/images/tongzhi.png">';
					$("#tongzhiSpan").html(img);
				}
			}
		}});
  	});
  </script>
</html>

     <!--中间部分-->       
<style>
.avast03{left:80px;float:left;position:fixed;}
.avast{width:16px;left:420px;cursor:pointer;position:fixed;z-index:9;height:80px;top:440;}
.avast1{width:16px;cursor:pointer;position:fixed;z-index:9;height:80px;top:440;}
.Tleft{margin-left:90px;}
.Tright{margin-left:440px;}	
.clear{clear:both;}
#avast01 {width:355px;float:left;margin:0px;}
video{max-width: 1200px;width: 80%;height: 500px;}
</style>	
		<div class="avast03">
			<input type="hidden" id="wsUrl" value="wss://ssl.tlink.io/tlink_websocket/?chat=YmM1NDlhNDYzNWVlNGJiZWEyNmQzZjUxN2E4YWM1ODZfZmQxMjdiYTRkYTRmNzkyNjU1ZGY0MTlhMWY5MThjMmVfMjAxOTA4MjgyMjExMTM=">
			<input type="hidden" id="ysAccessToken"  value="" />
            <div class="index_centen" id="avast01">
                <div class="conten_title">
                    <h4>我的设备</h4>
                    <table>
                        <tr>
                            <td><a style="cursor:pointer;" onclick="javascript:window.location.reload();">所有设备</a></td>
                            <td><a href="/device/addDevice.htm">添加设备</a></td>
                            
                              <td data-toggle="modal" data-target="#addAlarms"><a href="javascript:addAlarms();">添加触发器</a></td>
                            
                        </tr>
                    </table>
                </div>
                <div class="index_imgInfo_big">
                <input type="hidden" id="uid" value="200024636"/>
                <input type="hidden" id="d_userId" value="" />
            		
            		
                   <div class="index_img_infosN">
				        <div class="in_imgN" id="dev_200045655">
				        	<div class="img-no" style="display: none;">
	                   			<img src= "/images/no.png" />
	                   		</div>
				            <a href="/device/updateDevice.htm?deviceId=200045655&u=&url=/user/userIndex.htm" title="测试">
				                
				                  
				                  
				                  	<img src= "http://www.tlink.io/images/device-icon/non_online-1.png" onerror="this.src='/images/NotConnected.png'" title="增加协议，建立连接"/>
				                  
				                
				            </a>
				        </div>
				        <div class="in_infosN">
				        	<div class="img-text" style="display: none;">
	                   			数据上行过快已被禁用
	                   		</div>
				            <h4><a href="/device/updateDevice.htm?deviceId=200045655&u=&url=/user/userIndex.htm" title="测试">测试</a></h4>
				        </div>
				        <div class="pull-right">
				         	<a href="/device/devices/device-index/200045655/modbus.htm"><img class="newImage_eyes" title="设置连接协议" src="/images/setting.png" /></a>
				            <a onclick="divHide(200045655)" id="device_h_200045655"><img class="newImage_eyes" title="隐藏传感器" src="/images/closeEyes.png" /></a>
				            <a style="display:none;" onclick="divShow(200045655)" id="device_s_200045655"><img title="显示传感器" class="newImage_eyes" src="/images/openEyes.png" /></a>
				            <a onclick="onLocationClick(200045655)"><img title="查看传感器" class="newImage_eyes" src="/images/select_T.png" /></a>
				        </div>
				    </div>
				                   
                    
                   	
                   	
                </div>
            </div>
           
            <div class="avast" id="Thide">
            	<img src="../images/pre.png" />
            </div>
			<div class="avast1" id="Tshow" style="display:none;">
				<img src="../images/next.png" />
			</div>
			 <div class="clear">
            </div>
			</div>
           </div>
        </div>
            <!--右边部分-->

             
            <div  class="modal fade" id="myModal_hist" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	            <div class="modal-dialog hi_modal" id="_history">	                
	            </div>
  		    </div>
  		  
 			<div class="index_theRight" id="Tright">
				
                <p class="in_sen_title" id="divicename_200045655">
                	 测试
                	<span class="pull-right">序列号：P9S9ONZCT5U7H8X0</span>
                </p>
                	
                	
                	<div class="row infos_imgsTitle" id="device-item-200045655">
                    	<div class="col-sm-2">
                    	    
                    	         
                    	         
                    	             <img src="/images/temperature.png" onerror="this.src='/images/scenery-21.png'"/>
                    	         
                    	    
                        	<p style="padding:0px 0px 10px 10px;">ID:200315652</p>
                    	</div>
                    	<div class="col-sm-4">
                        	<h4>环境温度</h4>
                        	
	                        	<p>当前状态：
			                        <span id="sz_200315652"><font color="#ff0000;">未连接</font></span>
			                        
		                        </p>
		                        <p style="margin-top:14px;">更新时间：<span id="st_200315652">2019-08-18 15:51:04</span></p>
	                        
                    	</div>
                    	<div class="col-sm-3">
                    	      <span id="s_200315652">
	                    	     
	                    	     	
	                    	     	30.6
	                    	     
                    	      </span>
                    	      
                    	      
                    	      
                    	     <span class="value_unit">摄氏度</span>
                    	</div>
                    	<div class="pull-right">
                    	   
							    
							    
							    
							    
							        <a id="shouH_chart" onclick="showFrameDiv(200045655,200315652,'环境温度','摄氏度',1,'30.6','','','','','');">&nbsp;∨&nbsp;实时曲线</a>
	                        		<span data-toggle="modal" data-target="#myModal_hist"><a href="javascript:alertWin(200315652,200045655,30,1)">&nbsp;>&nbsp;历史查询</a></span>&nbsp;
							    
							
                    	</div>
                	</div>
                	<div style="margin-bottom:0px;" class="collapse" id="collapseExample_200045655_200315652" name="collapseExample_200045655">
                	     <input type="hidden" name="coll_200045655" id="coll_200045655_200315652" value="h" />
                	     
							    
							    
							    
						
                    </div>
                  
                	<div class="row infos_imgsTitle" id="device-item-200045655">
                    	<div class="col-sm-2">
                    	    
                    	         
                    	         
                    	             <img src="/images/temperature.png" onerror="this.src='/images/scenery-21.png'"/>
                    	         
                    	    
                        	<p style="padding:0px 0px 10px 10px;">ID:200315653</p>
                    	</div>
                    	<div class="col-sm-4">
                        	<h4>环境湿度</h4>
                        	
	                        	<p>当前状态：
			                        <span id="sz_200315653"><font color="#ff0000;">未连接</font></span>
			                        
		                        </p>
		                        <p style="margin-top:14px;">更新时间：<span id="st_200315653">2019-08-18 15:51:04</span></p>
	                        
                    	</div>
                    	<div class="col-sm-3">
                    	      <span id="s_200315653">
	                    	     
	                    	     	
	                    	     	48.7
	                    	     
                    	      </span>
                    	      
                    	      
                    	      
                    	     <span class="value_unit">%</span>
                    	</div>
                    	<div class="pull-right">
                    	   
							    
							    
							    
							    
							        <a id="shouH_chart" onclick="showFrameDiv(200045655,200315653,'环境湿度','%',1,'48.7','','','','','');">&nbsp;∨&nbsp;实时曲线</a>
	                        		<span data-toggle="modal" data-target="#myModal_hist"><a href="javascript:alertWin(200315653,200045655,30,1)">&nbsp;>&nbsp;历史查询</a></span>&nbsp;
							    
							
                    	</div>
                	</div>
                	<div style="margin-bottom:0px;" class="collapse" id="collapseExample_200045655_200315653" name="collapseExample_200045655">
                	     <input type="hidden" name="coll_200045655" id="coll_200045655_200315653" value="h" />
                	     
							    
							    
							    
						
                    </div>
                  
                
            
        <input type="hidden" id="active_" value="now" />
		<div class="modal fade" id="addAlarms">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title" id="alarmsTitle"></h4>
		      </div>
		      <div class="modal-body" id="myBody">
		      </div>
		    </div><!-- /.modal-content -->
		  </div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
  </body>
  <script src="/js/reconnecting-websocket.js"></script>
  <script src="/js/offline.js"></script>
<script>
	function initPlay(sensorId){
	    var playId = 'myPlayer_'+sensorId
	    var tagName = $("#"+playId)[0].tagName;
	    if("VIDEO" == tagName){
			new EZUIPlayer(playId);	
	    }else if("DIV" == tagName){
			var url = $('#live_'+sensorId).val().trim();
		    var accessToken = $('#ysAccessToken').val().trim();
		    var decoder = new EZUIKit.EZUIPlayer({
		        id: playId,
		        autoplay: true,
		        url: url,
		        accessToken: accessToken,
		        decoderPath: '../js/',
		        width: 1100,
		        height: 500,
		        handleError: handleError,
		    });
	    }
	}
	
	function handleError(e){
        console.log('捕获到错误',e);
    }
	 
 	/**比较两个时间大小**/
 	function compareTime(t1,t2){
 		var a = new Date(Date.parse(t1));
		var b = new Date(Date.parse(t2));
		return a > b;
 	}
 	
	$(document).ready(function(){
		  $("#Thide").click(function(){
			  $("#avast01").hide();
			  $("#Thide").hide();
			  $("#Tshow").show();
			  $("#Tright").addClass("Tleft");
			  $("#Tright").removeClass("Tright");
			});
		  $("#Tshow").click(function(){
			  $("#avast01").show();
			  $("#Tshow").hide();
			  $("#Thide").show();
			  $("#Tright").addClass("Tright");
			  $("#Tright").removeClass("Tleft");
		  });  
	 });
	
    /**
    if (!window.WebSocket){
    	if(confirm('您的浏览器版本较低,将不能收到设备发送的实时数据，建议下载Tlink推荐浏览器.')){
   			llq.click();
   	  	}
	}**/
	
	var d = new Date();
    var year = d.getFullYear();
    var month = d.getMonth()+1;
    var day = d.getDate();
    if(month<10){
    	month="0"+month;
    }
    
    if(day<10){
    	day="0"+day;
    }
    
	var nowDate = year+"-"+month+"-"+day;
	var socketStatus=false;
	
	function checkSocketLine(){
	    Offline.check();
	    if(!socketStatus){
	        if(Offline.state === 'up' && WebSocket.reconnectAttempts>WebSocket.maxReconnectInterval){
	            window.location.reload();
	        }
	    }
	}
	
	var ws;
	var t1;
	buildSocket();
	function buildSocket(){   
		var wsUrl=$("#wsUrl").val();
	    ws = new ReconnectingWebSocket(wsUrl); 
	}
	
	ws.onopen = function (evnt) {
	    socketStatus=true;
	    clearInterval(t1);//去掉定时器
	    t1=setInterval(checkSocketLine,10000);
	};
	
	ws.onmessage = function (message) {
		if(message.data != 'request_fail'){
	    	var uid = $("#uid").val();
	    	var jsonObj = eval('('+message.data+')');
	    	if(Number(uid) == Number(jsonObj.deviceUserid)){
	    		var dataObj=eval(jsonObj.sensorsDates);  
	    		var de_Id = jsonObj.deviceId; //设备Id
	    		//设置当前的设备在线图标，并且获取报警图标
	    		var alarmDeviceIcon = getLineDeviceIcon(de_Id);
	    		if(dataObj!=null){
	    			var alarms = null;
		   			for(var i=0;i<dataObj.length;i++){
		   				var sensorsTypeId = dataObj[i].sensorsTypeId;
		   				var updateTime = nowDate+" "+dataObj[i].times;
		   				var sensorId = dataObj[i].sensorsId;
		   				var isAlarm = dataObj[i].isAlarm;
		   				var val = '';
		   				var lastTime = $("#st_"+sensorId).val();
		   				var isadd = compareTime(lastTime,updateTime);
		   				if(isadd){
		   				   continue;
		   				}
		   				
		   				if('1' == sensorsTypeId || '6'== sensorsTypeId || '8' == sensorsTypeId){  //数值/档位和开关型
		   				    if('1' == sensorsTypeId){
		   				    	val = dataObj[i].value;
		   				    }else if('6' == sensorsTypeId){
	   					      val = dataObj[i].gear;
	   					    }else if('8' == sensorsTypeId){
	   					      val = dataObj[i].string;
	   					    }
	   					    
	   					    if(''!=val && 'null'!=val){
			   					if(isAlarm == "1"){  //需要报警
			   						$("#s_"+sensorId).html("<font color='red'>"+val+"</font>");
			   						alarms = true;
			   					}else{
			   						$("#s_"+sensorId).html(val);
			   						if(null == alarms || !alarms){
			   							alarms = false;
			   						}
			   					}
			   				   $("#st_"+sensorId).html(updateTime);
							   $("#sz_"+sensorId).html("<font color='#45b97c;'>已连接</font>");
		   					}
		   				}else if('2' == sensorsTypeId || '5'== sensorsTypeId){ //开关型
		   				  if('1' == dataObj[i].switcher){
							    if(isAlarm == "1"){  //需要报警
									$("#switch_"+sensorId).css("background","url(https://www.tlink.io/images/alarm_open.png)");
									alarms = true;
			   					}else{
									$("#switch_"+sensorId).css("background","");
									$("#switch_"+sensorId).attr("class","infos_open_");
									if(null == alarms || !alarms){
			   							alarms = false;
			   						}
								}
								$("#sz_"+sensorId).html("<font color='#45b97c;'>已连接</font>");
		   						$("#st_"+sensorId).html(updateTime);
						   }else if('0' == dataObj[i].switcher){
							    if(isAlarm == "1"){  //需要报警
									$("#switch_"+sensorId).css("background","url(https://www.tlink.io/images/alarm_close.png)");
									alarms = true;
			   					}else{
									$("#switch_"+sensorId).css("background","");
									$("#switch_"+sensorId).attr("class","infos_close_");
									if(null == alarms || !alarms){
			   							alarms = false;
			   						}
								}
								$("#sz_"+sensorId).html("<font color='#45b97c;'>已连接</font>");
		   					    $("#st_"+sensorId).html(updateTime);
						   }
		   				}else if('3' == sensorsTypeId){ //定位型
		   					if(dataObj[i].lng != '0' && dataObj[i].lat != '0'){
		   						$("#lng_"+sensorId).html(Math.floor(dataObj[i].lng * 100) / 100);
		   						$("#lat_"+sensorId).html(Math.floor(dataObj[i].lat * 100) / 100);
		   						$("#st_"+sensorId).html(updateTime);
								$("#sz_"+sensorId).html("<font color='#45b97c;'>已连接</font>");
		   					}
		   				}else if('4'==sensorsTypeId){  //图片型
		   				   val = dataObj[i].imgHex;
		   				   if(null != val && !"" != val && undefined != val){
				   		   		$("#nowImg_"+sensorId).html("<img src='http://47.107.38.82/"+val+"' />");
				   		   	    $("#st_"+sensorId).html(updateTime);
		   				   }
				   		}else if('7' == sensorsTypeId){
				   			var isline = dataObj[i].isLine;
				   			if('1' == dataObj[i].isLine){
				   				$("#sz_"+sensorId).html("<font color='#45b97c;'>已连接</font>");
				   				$("#st_"+sensorId).html(updateTime);
				   			}else{
				   				$("#sz_"+sensorId).html("<font color='#ff0000;'>未连接</font>");
				   			}
				   		}
		   			} //for
		   			
		   			if(alarms){
		   				$("#dev_"+de_Id).find("a").html("<img src='/images/device-icon/alarm_"+alarmDeviceIcon+"' title='已设置连接,编辑协议'/>");
		   			}else if(null!=alarms && !alarms){
		   				$("#dev_"+de_Id).find("a").html("<img src='/images/device-icon/"+alarmDeviceIcon+"' title='已设置连接,编辑协议'/>");
		   			}
		   			
	   			} //
	    	  }
	      }
	};
	
	ws.onerror = function (evnt) {
	    socketStatus=false;
	};
	
	ws.onclose = function (evnt) {
	    socketStatus=false;
	};

    function onLocationClick(id) { 
   		//window.location.hash = "#device-item-0";
      	//window.location.hash = "#device-item-"+id;  
		var _id = document.getElementById("divicename_"+id);
		var y=parseInt(_id.offsetTop)-62;
		window.scrollTo(0,y);
    } 
    
    function divHide(id){
    	$("#device_s_"+id).show();
    	$("#device_h_"+id).hide();
    	$("div[id*='device-item-"+id+"']").hide();
    	$("#divicename_"+id).hide();
    	$("iframe[name*='iframe_"+id+"']").remove();
    	$("input[name*='coll_"+id+"']").attr("value","h");
    	$("div[name*='collapseExample_"+id+"']").hide();
    	
    }
    
    function divShow(id){
    	$("div[id*='device-item-"+id+"']").show();
    	$("#divicename_"+id).show();
    	$("#device_h_"+id).show();
    	$("#device_s_"+id).hide();
    }
    
     function addAlarms(){
          var title = '添加触发器';
          var src = '/alarms/toAddAlarms.htm';
	      $.get(src, function(data){
	      	$("#alarmsTitle").html(title);
			$("#myBody").html(data);
		  }); 
	}
	
	function showFrameDiv(deviceid,id,name,unit,type,val,switcher,sensorSwitch,switchGear,lng,lat){
		var coll = $("#coll_"+deviceid+"_"+id).val();
	    if("1" == type ||  "2" == type || "5" == type || "6" == type){//数值型
			if(coll == 'h'){
				$("#collapseExample_"+deviceid+"_"+id).append('<iframe name="embed-responsive-item iframe_'+deviceid+'" id="iframe_'+deviceid+'_'+id+'" style="width:100%;height:500px;border:none;"></iframe>');
				$("#iframe_"+deviceid+"_"+id).attr("src","/user/queryLineData.htm?sensorId="+id);
				
				$("#collapseExample_"+deviceid+"_"+id).show();
				$("#coll_"+deviceid+"_"+id).val("s");
			}else{
				$("#iframe_"+deviceid+"_"+id).remove();
				
				$("#iframe_"+deviceid+"_"+id).removeAttr("src");
				$("#collapseExample_"+deviceid+"_"+id).hide();
				$("#coll_"+deviceid+"_"+id).val("h");
			}
		}else if("3" == type){ //定位型
			if(coll == 'h'){
				$("#iframeLat_"+deviceid+"_"+id).attr("src","/user/queryLngLat.htm?sensorId="+id+"&lng="+lng+"&lat="+lat+"&deviceId="+deviceid);
				$("#collapseExample_"+deviceid+"_"+id).show();
				$("#coll_"+deviceid+"_"+id).val("s");
			}else{
				$("#iframeLat_"+deviceid+"_"+id).removeAttr("src");
				$("#collapseExample_"+deviceid+"_"+id).hide();
				$("#coll_"+deviceid+"_"+id).val("h");
			}
		}else{  //图片
		    if(coll == 'h'){
				$("#collapseExample_"+deviceid+"_"+id).show();
				$("#coll_"+deviceid+"_"+id).val("s");
				if("7" == type){
				   initPlay(id);
				}
			}else{
				$("#collapseExample_"+deviceid+"_"+id).hide();
				$("#coll_"+deviceid+"_"+id).val("h");
			}
		}
	}
		
	function alertWin(sensorId,deviceId,timeInterval,sensorType){   
	    $("#_history").empty();
	    $("#_dateCont").remove();
	    if('7' == sensorType){
	    	var url = $('#replay_'+sensorId).val().trim();
	    	var accessToken = $('#ysAccessToken').val().trim();
			var reqData = {url:url,accessToken:accessToken}
			$.post("/device/videoReplay.htm",reqData,function(data){
				$("#_history").html(data);
			}); 
		}else{
		    var reqData = {sensorId:sensorId,deviceId:deviceId,timeInterval:timeInterval}
			if('3' == sensorType){//
			    $.post("/device/positioning.htm",reqData,function(data){
					$("#_history").html(data);
				}); 
			}else{
			    $.post("/device/history.htm",reqData,function(data){
					$("#_history").html(data);
				}); 
		   }
		}
	}
	
   function switchVal(sensorId,deviceNo,userKey){
     $("#_body").attr("style","padding-right:0px");
     var _switch;
     if($("#switch_"+sensorId).attr("class") == 'infos_open_'){
     	_switch = '0';
     }else if($("#switch_"+sensorId).attr("class") == 'infos_close_'){
     	_switch = '1'
     }
	 $.ajax({url:"/device/sendSwitchVal.htm", 
         type:"POST",
           data:{
              "deviceNo" : deviceNo,
              "sensorId" :sensorId,
              "userKey" : userKey,
              "value"  : _switch
            },
            success:function (data) {
            var jsonObj = $.parseJSON(data);
            $("#_switch"+sensorId).val("-1");
            $("#_num"+sensorId).val("0");
			if ('00' == jsonObj.flag) {
			    if('1' == _switch){
				    $("#switch_"+sensorId).attr("class","infos_open_");
				    if(null!=$("#switch_"+sensorId).attr("style") && "" != $("#switch_"+sensorId).attr("style")){
				    	$("#switch_"+sensorId).css("background","url(https://www.tlink.io/images/alarm_open.png)");
				    }
				}else if('0' == _switch){
				    $("#switch_"+sensorId).attr("class","infos_close_");
 					if(null!=$("#switch_"+sensorId).attr("style") && "" != $("#switch_"+sensorId).attr("style")){
 						$("#switch_"+sensorId).css("background","url(https://www.tlink.io/images/alarm_close.png)");
				    }
				}
			} else {
				if('1' == _switch){
				    $("#switch_"+sensorId).attr("class","infos_open_");
  					if(null!=$("#switch_"+sensorId).attr("style") && "" != $("#switch_"+sensorId).attr("style")){
  						$("#switch_"+sensorId).css("background","url(https://www.tlink.io/images/alarm_open.png)");
				    }
				}else if('0' == _switch){
				    $("#switch_"+sensorId).attr("class","infos_close_");
   					if(null!=$("#switch_"+sensorId).attr("style") && "" != $("#switch_"+sensorId).attr("style")){
   						$("#switch_"+sensorId).css("background","url(https://www.tlink.io/images/alarm_close.png)");
				    }
				}
	       }
	       
	 }});
   }

	//获取当前的设备在线图标
	function getLineDeviceIcon(deviceId){
	 	var deviceIcon=$("#dev_"+deviceId).find("a").find("img").attr("src");
	 	var index = deviceIcon.lastIndexOf("/");
	 	var imgName = deviceIcon.substring(index+1);
	 	if(imgName.indexOf("_")>=0){
	 		if(imgName.indexOf("non")!=-1){
	 			$("#dev_"+deviceId).find("a").html("<img src='/images/device-icon/"+imgName.split("_")[1]+"' title='已设置连接,编辑协议'/>");
	 		}
	 		imgName = imgName.split("_")[1];
	 	}
	 	//var alarmImgName="alarm_"+imgName;	//报警状态图标
		return imgName;
	}
</script>
</html>
